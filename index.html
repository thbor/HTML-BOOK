<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="./css/layui.css">  
    <link rel="stylesheet" href="./css/swiper.min.css">  
    <link rel="stylesheet" href="./css/common.css">  
    <script type="text/javascript" src="./js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="./layui/layui/dist/layui.all.js"></script>
    <script type="text/javascript" src="./js/swiper.min.js"></script>
    <script type="text/javascript" src="./js/common.js"></script>
</head>
<body >
  
     <!--上面部分-->
     <div class=" nav1">
        <div class="layui-row">
          <div class="layui-col-md3 cursor  " onclick="clickTitle()">
            <div class="ib mf">
                <img src="./image/book2.png" height="50" width="50">
                <span class="title white">在线书屋</span>
            </div>
          </div>
        
          <div class="float-right mr-1" style="display: none;" id="notLogin">
            <button type="button" class="layui-btn layui-btn-primary" onclick="clickLogin()">登录</button>
            <button type="button" class="layui-btn layui-btn-primary" onclick="clickRegister()">注册</button>
          </div>
          <div id="logged" style="display: none;border: 1px solid transparent;width: 100px;height: 100px;float: right;" onmousemove="showPerson()" onmouseout="hiddenPerson()">
                <img src="./image/girl.jpg" class="float-right circle tx"  >
                <div class="showLogout" style="visibility:hidden;" id="showLogout">
                  <li class="li-showLogout" onclick="logout()">退出登錄</li>
                  <li class="li-showLogout"><a href="./MyShelf.html">我的書架</a></li>
                </div>
          </div>
        </div>
      </div>

      <div>
            <!--面包屑-->
            <!-- <ul class="layui-nav test" lay-filter="">
               <li class="layui-nav-item"><a href="">首页</a></li>
               <li class="layui-nav-item layui-this"><a href="">玄幻魔法</a></li>
               <li class="layui-nav-item"><a href="">武侠修真</a></li>
               <li class="layui-nav-item">
                 <a href="javascript:;">都市言情</a>
                 <dl class="layui-nav-child"> 
                   <dd><a href="">历史军事</a></dd>
                   <dd><a href="">侦探推理</a></dd>
                   <dd><a href="">网游动漫</a></dd>
                 </dl>
               </li>
               <li class="layui-nav-item"><a href="">社区</a></li>
             </ul> -->
           <!--面包屑 end-->
      </div>

        <div class="center mt-nav">
            <input type="text" name="bookSearch" placeholder="请输入书名或作者搜索" autocomplete="off" class="layui-input search">
            <span><button class="layui-btn layui-btn-primary border-0"><i class="layui-icon layui-icon-search"></i></button></i></span>
        </div>
        <!--上面部分 end-->
        <!--轮播图-->
        <div>
            <div class="left">
                <div class="category inside-div mt-1">
                    <div class="center" style="font-size: 18px;">作品分类</div>
                    <div id="category"></div>
                </div>
                <div class="newBook inside-div mt-1">
                    <div class="center bb" style="font-size: 18px;">新书推荐</div>
                    <div id="newBook"></div>
                </div>

            </div>
            <div class="right ">
                <div class="layui-carousel" id="carouselId">
                    <div carousel-item id="itemId"></div>
                </div>
                <div id="bookInfo" class="inside-div" style="width:98%;margin: 1%;">
                  <div style="width: 100%;height: 30%;">
                  top
                  
                  </div>
                  <div style="width: 100%;height: 70%; ">
                    <div style="float:left;width: 40%;height: 100%;">
                      <div>
                        <div style="font-size: 20px" class=" bb-2"></div>
                          <div class="swiper-div bb-2 ib">
                            <div class="swiper-container">
                              <div class="swiper-wrapper" id="wrapperId"></div>
                            </div>
                          </div>
                      </div>
                    </div>
                    <div class="bookDesc" >
                      <div id="bookDesc" ></div>
                    </div>
                  </div>
                  </div>
            </div>
        </div>
        <!--登录-->
            <form class="layui-form" id="loginId" action="" style="display: none;">
                <div class="layui-form-item">
                  <label class="layui-form-label">用戶名</label>
                  <div class="layui-input-block">
                    <input type="text" name="lusername" lay-verify="lusername" placeholder="请输入用戶名" autocomplete="off" class="layui-input">
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">密码</label>
                  <div class="layui-input-inline">
                    <input type="password" name="lpassword" lay-verify="lpassword" placeholder="请输入密码" autocomplete="off" class="layui-input">
                  </div>
                </div>
                <!-- <button class="sub-bindbtn" lay-submit lay-filter="bind" style="display: none;"> -->
              </form>
        <!--登录 end-->
        <!--註冊-->
        <form class="layui-form" action="" id="registerId" style="display: none;">
            <div class="layui-form-item">
                <label class="layui-form-label">用户名</label>
                <div class="layui-input-block">
                <input type="text" name="rusername" lay-verify="rusername"  placeholder="请输入用户名" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">密码</label>
                <div class="layui-input-block">
                <input type="password" name="rpassword" id="rpassword" lay-verify="rpassword" placeholder="请输入密码" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">確認密码</label>
                <div class="layui-input-block">
                <input type="password" name="rcheckPassword" id="rcheckPassword" lay-verify="rcheckPassword" placeholder="请输入密码" autocomplete="off" class="layui-input">
                </div>
            </div>
        </form>
      
        <!--註冊 end-->
        <!--轮播图 end-->
        <script>
            //初始化
            $(function() {
              //验证是否登录，登录则显示用户信息，否则显示登录信息
              ifLogin();
              getCarouselItem();
              getNewBook();
              getCategory();
              initSwiper();
              // logout();
            });
            function showPerson(){
              let s = document.getElementById("showLogout")
              s.style.visibility = ""
            }
            function hiddenPerson(){
              let s = document.getElementById("showLogout")
              s.style.visibility = "hidden"
            }
            //初始化swiper的dom
            function initSwiper(){
              //這裡字段不能多空格，否則拼接會報錯
              let swiperJson=[
                {img1:1,bookName:"我真的是人生赢家",author:"刘阿懦",desc:"我真的是人生赢家的简介........................ "},
                {img1:2,bookName:"2",author:"a2",desc:"222222222 "},
                {img1:3,bookName:"3",author:"a3",desc:"33333333 "},
                {img1:4,bookName:"4",author:"a4",desc:"4444444444 "},
                {img1:5,bookName:"5",author:"a5",desc:"5555555 "},
                {img1:6,bookName:"6",author:"a6",desc:"66666 "},
                {img1:7,bookName:"7",author:"a7",desc:"777777 "},
                {img1:8,bookName:"8",author:"a8",desc:"888888 "},
                ];
              let nHtml="";
              if(swiperJson.length>0){
                var keys = Object.keys(swiperJson[0]);
              }
              for(let i=0;i<swiperJson.length;i++){
                let item = swiperJson[i]
                for(let key of keys){
                  if(typeof(item[key])=="string"){
                    item[key] = item[key].trim()
                  }
                }

                nHtml+='<div class="swiper-slide"><img onclick=swiperItemClick('+JSON.stringify(item)+') src="./image/'+item.img1+'.jpg" class="img2" title="'+item.bookName+'">'+item.bookName+'</div>'
              }
              $("#wrapperId").html(nHtml)
              getSwiper(swiperJson);
            }
            function getSwiperDesc(item){
              let nHtml = "";
              nHtml+='<div class="bookname bb-2 center">'+item.bookName+'</div>'
              nHtml+='<div class="bb-1">'+"作者:"+item.author+'</div>'
              nHtml+='<div class="bb-1">'+"簡介:"+item.desc+'</div>'
              nHtml+='<div class="bb-1 center"><button type="button" class="layui-btn layui-btn-primary" ><a href="http://www.baidu.com">'+"書籍詳情"+'</a></button></div>'
              $("#bookDesc").html(nHtml)
            }
            
            //將swiper顯示出來
            function getSwiper(swiperJson){
              var mySwiper = new Swiper('.swiper-container', {
              //速度
              speed:300,
              autoplay : {
                //延遲
                delay:1000
              },
              //初始化爲initialSlide+1=下標
              initialSlide:-1,
              //是否一直循環
              loop:true,
              effect : 'coverflow',
              //同时显示的slides数量
              slidesPerView : 3,
              //active slide会居中
              centeredSlides : true,
              //使得第一个和最后一个Slide 始终贴合边缘。
              centeredSlidesBounds: true,
              // pagination :{
              //   el: '.swiper-pagination',
              //   clickable :true,
              // },
              on:{
                //監聽自動切換  this.realIndex是當前的索引
              autoplay:function(){
                // var txt = $('.swiper-slide-active').attr('data-swiper-slide-index');   
                // console.log(this.realIndex+1)
                getSwiperDesc(swiperJson[this.realIndex])
                  },
                }
              })
            }
            //點擊swiper（點擊一本書）
            function swiperItemClick(item){
              console.log(item)
              getSwiperDesc(item)
            }
            function logout(){
              quesForm('你確定要退出登錄嗎?',realLogout)
            }
            function realLogout(){
              sessionStorage.removeItem("status")
              layer.closeAll()
              ifLogin();
            }
            //用户是否登录  status：0.未登录  1.已登陆
            function ifLogin(){
              //TODO  sessionStorage.setItem("status", 0);放在login方法里
              // sessionStorage.setItem("status", 0);
              var value = sessionStorage.getItem("status");
              console.log(value)
              if(!value){
                document.getElementById("notLogin").style.display="";//显
                document.getElementById("logged").style.display="none";//隱
                layer.msg('你已退出登錄', {icon: 2})
                
              }else{
                document.getElementById("notLogin").style.display="none";//隐
                document.getElementById("logged").style.display="";//显
                layer.msg('登錄成功', {icon: 1})
              }   
            }
            //登錄表單驗證
            function validateLogin(form){
              var form = layui.form;
              form.verify({
                    lusername:function(value){
                      if(value.length==0){
                         return '用戶名不能爲空'
                       }
                    },
                    lpassword: function(value) {
                       if(value.length==0){
                         return '密碼不能爲空'
                    }
                  }
                });
            }
           
            //註冊表單驗證
            function validateRegister(form){
              form.verify({
                rusername:function(value){
                  if(value.length==0){
                     return '用戶名不能爲空'
                    }
                },
                rpassword:function(value){
                  if(value.length<6){
                     return '密码不能小於6位'
                    }
                },
                // rpassword:  [
                //   /^[\S]{6,12}$/,
                //   '密码必须6到12位，且不能出现空格'
                // ],
                });
            }

            function clickLogin(){
              alertcomfirm("loginLayer","登录","#loginId",'loginVerify',validateLogin,ajaxLogin)
            }
            function clickRegister(){
              alertcomfirm("registerLayer","註冊","#registerId",'registerVerify',validateRegister,ajaxRegister)
            }
            function ajaxLogin(data){
              console.log(data)
              //如果成功，將status寫入session
              sessionStorage.setItem("status", 1);
              layer.closeAll()
              ifLogin()
            }
            function ajaxRegister(data){
              console.log("ajaxRegister",data)
              if(data.rpassword!==data.rcheckPassword){
                layer.msg('兩次輸入的密碼不一致', {icon: 5});
                return false;
              }
              layer.closeAll()
            }
            function testId(){
              $("#test").toggleClass("blue")
            }
            function clickTitle(){
              alert("即将前往首页")
            }
            function clickBook(i){
              console.log("点击书");
              console.log(i)
              //跳转该书到书籍详细页面
            }
            function onmouseoverBook(item){
              console.log(item)
              // let cHtml =""
              // cHtml+='<div>书名：'+item.bookName+'</div><div>作者：'+item.author+'</div><div>简介：'+item.des+'</div>'
              // $("#bookInfo").html(cHtml)
              //显示书籍的相关信息到下面
            }
            //获取轮播图数据axios得到json数据
            function getCarouselItem(){
                // carouselData=[
                //     name:"临元行"
                // ]
              var bookJson=[
                {bookName:"密战无痕",author:"长风",category:"历史军事",des:"密战无痕的简介"},
                {bookName:"凡尘一剑",author:"剑东来",category:"武侠修真",des:"凡尘一剑的简介"},
                {bookName:"我真的是人生赢家",author:"刘阿懦",category:"其他类型",des:"我真的是人生赢家的简介"},
                {bookName:"次元法典",author:"西贝猫",category:"网游动漫",des:"托身白刃里，浪迹红的简介"},
                {bookName:"托身白刃里，浪迹红",author:"接卡口",category:"武侠修真",des:"密战无痕的简介"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情",des:"密战无痕的简介"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情",des:"密战无痕的简介"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情",des:"密战无痕的简介"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情",des:"密战无痕的简介"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情",des:"密战无痕的简介"},
                ]
              var cHtml="";
                for(let i=1;i<=bookJson.length;i++){
                  let item = bookJson[i-1];
                   //开始
                  if(i%5==1){
                    cHtml+='<div><div class="book"><img src="./image/'+i+'.jpg" class="img1" title="'+item.bookName+'" onclick=clickBook('+JSON.stringify(item)+') onmouseover=onmouseoverBook('+JSON.stringify(item)+')>'+item.bookName+'</div>'
                  }
                  //结束
                  if(i%5==0){
                    cHtml+='<div class="book"><img src="./image/'+i+'.jpg" class="img1" title="'+item.bookName+'" onclick=clickBook('+JSON.stringify(item)+') onmouseover=onmouseoverBook('+JSON.stringify(item)+')>'+item.bookName+'</div></div>'
                  }
                  //中间
                  if(i%5!=1&&i%5!=0){
                    cHtml+='<div class="book"><img src="./image/'+i+'.jpg" class="img1" title="'+item.bookName+'" onclick=clickBook('+JSON.stringify(item)+') onmouseover=onmouseoverBook('+JSON.stringify(item)+')>'+item.bookName+'</div>'
                  }
                }
                $("#itemId").html(cHtml)
                layui.use('carousel', function(){
                var carousel = layui.carousel;
                //建造实例
                carousel.render({
                  elem: '#carouselId'
                  ,width: '100%' //设置容器宽度
                  ,arrow: 'none' //始终显示箭头
                  // ,anim: 'updown' //切换动画方式
              });
            });
            }
            layui.use('element', function(){
              var element = layui.element;
            });
            function getNewBook(){
              let nHtml = "";
              let newBookJson=[
                {bookName:"密战无痕",author:"长风",category:"历史军事"},
                {bookName:"凡尘一剑",author:"剑东来",category:"武侠修真"},
                {bookName:"我真的是人生赢家",author:"刘阿懦",category:"其他类型"},
                {bookName:"次元法典",author:"西贝猫",category:"网游动漫"},
                {bookName:"托身白刃里，浪迹红尘里",author:"接卡口",category:"武侠修真"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情"},
                {bookName:"我的异能悠闲生活",author:"开水很白",category:"都市言情"},
              ]
              for(let i=0;i<newBookJson.length;i++){
                let item = newBookJson[i];
                let itemBook = newBookJson[i].bookName;
                if(item.bookName.length>4){
                    itemBook = itemBook.substring(0,4)+"..."
                }
                nHtml+='<div class="newBook-div bb">'
                nHtml+='<span class="float-left">'+'<a href="http://www.baidu.com" title="'+item.bookName+'">'+'['+item.category+']'+itemBook+'</a>'+'</span>';
                nHtml+='<p class="float-right">'+item.author+'</p>'
                nHtml+='</div>'
              }
              $("#newBook").html(nHtml);
            }
            function getCategory(){
              let categoryJson=["历史军事","武侠修真","其他类型","网游动漫","都市言情","都市言情","都市言情","都市言情","玄幻魔法"]
              let nHtml = ""
              for(let i=1;i+1<=categoryJson.length;i++){
                let item = categoryJson[i-1];
                let item2 = categoryJson[i];
                i++;
                if(parseInt((i-1)/2)%2==0){
                  nHtml+='<div class="b1">'
                }else{
                  nHtml+='<div class="b2">'
                }
                //TODO  需要修改分类的地址
                nHtml+='<div class="cateItem center">'+'<a href="http://www.baidu.com">'+item+'</a>'+'</div>';
                nHtml+='<div class="cateItem center">'+'<a href="http://www.baidu.com">'+item2+'</a>'+'</div>';
                nHtml+='</div>'
                //为奇数且为最后一个节点时
                if(i+1==categoryJson.length){
                  let item3 = categoryJson[i];
                  nHtml+='<div class="b1">'
                  nHtml+='<div class="cateItem center">'+'<a href="http://www.baidu.com">'+item3+'</a>'+'</div>';
                  nHtml+='</div>'
                  }
                }
                $("#category").html(nHtml);
            }
        </script>
</body>
</html>
