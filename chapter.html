<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>ç« èŠ‚</title>
    <link rel="stylesheet" href="./css/layui.css">  
    <link rel="stylesheet" href="./css/common.css">  
    <script type="text/javascript" src="./js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="./layui/layui/dist/layui.all.js"></script>
    <script type="text/javascript" src="./js/common.js"></script>
</head>
<body>
  <!-- contenteditable="true" -->
   <div class="contenttext" >
    ã€Šçº¢æ¥¼æ¢¦ã€‹åœ¨ä¸­å›½å°è¯´è‰ºæœ¯å‘å±•å²ä¸Šï¼Œæ—¢ç»“æŸäº†ä¸€ä¸ªæ—¶ä»£ï¼Œ
    ä¹Ÿå¼€åˆ›äº†ä¸€ä¸ªæ—¶ä»£ã€‚å®ƒçš„ä½œè€…æ›¹é›ªèŠ¹æ¯”æ‰˜å°”æ–¯æ³°ã€å·´å°”æ‰å…‹ã€
    ç‹„æ›´æ–¯ç­‰ä¸–ç•Œæ€§çš„è‰ºæœ¯å·¨æ“˜è¦æ—©ä¸€ä¸ªä¸–çºªï¼Œå°±ç™»ä¸Šäº†å…¨çƒæ–‡å­¦çš„é«˜å³°ã€‚
    åŒæ—¶ï¼Œã€Šçº¢æ¥¼æ¢¦ã€‹è¿˜æ˜¯ä¸æ•´ä¸ªä¸­å›½æ°‘æ—æ–‡åŒ–ç´§ç´§è”ç³»åœ¨ä¸€èµ·çš„ï¼Œ
    äººä»¬ä¸€æèµ·ã€Šçº¢æ¥¼æ¢¦ã€‹å°±è‡ªç„¶æƒ³åˆ°äº†ä¸­å›½æ°‘æ—æ–‡åŒ–ï¼Œè€Œä¸€æèµ·ä¸­å›½æ°‘æ—æ–‡åŒ–ï¼Œ
    å°±è‡ªç„¶æƒ³åˆ°äº†ã€Šçº¢æ¥¼æ¢¦ã€‹ã€‚ç„¶è€Œï¼ŒæŠŠæˆ‘å›½å¤ä»£å°è¯´å‘å±•æ¨å‘é¡¶å³°çš„æ›¹é›ªèŠ¹ï¼Œ
    åœ¨å…¶ç”Ÿå‰ä¸èº«åå¹¶ä¸æ˜¯éƒ½è·å¾—äººä»¬åº”æœ‰çš„è®¤è¯†ï¼Œå°½ç®¡ä»–çš„ã€Šçº¢æ¥¼æ¢¦ã€‹ä»ä¸€é—®ä¸–å°±å—åˆ°äº†è¯»è€…çš„å–œçˆ±ï¼Œ
    ä»¥é«˜ä»·äº‰è´­è¿™éƒ¨ä»¤äººå…¥è¿·çš„å°è¯´ï¼Œè¾¾åˆ°äº†â€œå¼€è°ˆä¸è¯´ã€Šçº¢æ¥¼æ¢¦ã€‹ï¼Œè¯»å°½è¯—ä¹¦æ˜¯æ‰ç„¶â€ï¼ˆã€Šäº¬éƒ½ç«¹æè¯ã€‹ï¼‰çš„ç¨‹åº¦ï¼Œ
    ä½†æœ‰å…³ä½œè€…çš„çœŸå®æƒ…å†µå´å¾ˆå°‘æœ‰äººè®°è¿°ã€‚ç›´åˆ°æœ¬ä¸–çºª20å¹´ä»£åˆï¼Œèƒ¡é€‚è€ƒè®¢ã€Šçº¢æ¥¼æ¢¦ã€‹çš„ä½œè€…ä¸ºæ›¹é›ªèŠ¹ï¼Œåˆ
    ç»è¿‡åŠä¸ªå¤šä¸–çºªå­¦è€…ä»¬çš„è€ƒç´¢ï¼Œæ‰ä½¿æˆ‘ä»¬å¯¹ã€Šçº¢æ¥¼æ¢¦ã€‹ä½œè€…æœ‰äº†ä¸€äº›å¹¶ä¸è¯¦å°½çš„äº†è§£ã€‚æ›¹é›ªèŠ¹åéœ‘ï¼Œå­—æ¢¦é˜®ï¼Œ
    å·é›ªèŠ¹ï¼Œåˆå·èŠ¹åœƒã€èŠ¹æºªï¼Œç”Ÿäºæ¸…ä»£åº·ç†™æœ«å¹´ï¼ˆ1715?ï¼‰ã€‚å…ˆä¸–åŸæ˜¯æ±‰æ—ï¼Œå¤§çº¦åœ¨æ˜ä»£åæœŸè¢«ç¼–å…¥æ»¡æ´²æ­£ç™½æ——ï¼Œ
    èº«åˆ†æ˜¯â€œåŒ…è¡£â€ã€‚è¿™ç§â€œåŒ…è¡£â€çš„å®¶åº­ï¼Œå¯¹çš‡å¸ï¼Œä»–ä»¬æ˜¯å¥´æ‰ï¼›è€Œè®ºå…¶åœ°ä½ï¼Œåˆ™åˆå±è´µæ—ã€‚æ›¹é›ªèŠ¹çš„æ›¾ç¥–æ›¹çºä»»æ±Ÿå®ç»‡é€ ï¼Œ
    æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
   </div>
   
   <div id="showBjDiv" style="display: none;"  >
      
   </div>
   <!-- <button id="SetToBold" onclick="SetToBold()">click</button> -->
<!--    
   <div class="contenttext">
    å’Œå®¢æˆ·ç«¯çš„ JavaScript ä¸åŒçš„æ˜¯ï¼ŒPHP ä»£ç æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ã€‚å¦‚æœæ‚¨åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šå»ºç«‹äº†å¦‚ä¸Šä¾‹ç±»ä¼¼çš„ä»£ç ï¼Œåˆ™åœ¨è¿è¡Œè¯¥è„šæœ¬åï¼Œå®¢æˆ·ç«¯å°±èƒ½æ¥æ”¶åˆ°å…¶ç»“æœï¼Œä½†ä»–ä»¬æ— æ³•å¾—çŸ¥å…¶èƒŒåçš„ä»£ç æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚æ‚¨ç”šè‡³å¯ä»¥å°† WEB æœåŠ¡å™¨è®¾ç½®æˆè®© PHP æ¥å¤„ç†æ‰€æœ‰çš„ HTML æ–‡ä»¶ï¼Œè¿™ä¹ˆä¸€æ¥ï¼Œç”¨æˆ·å°±æ— æ³•å¾—çŸ¥æœåŠ¡ç«¯åˆ°åº•åšäº†ä»€ä¹ˆã€‚  
    </div> -->




   
  </body>
<script>
      $(function() {
        init();
        t();
        // t2();
      });
      function init(){
      
      }
      function t(){
        $('.contenttext').mouseup(function(){
          // SetToBold();
          var range = window.getSelection().getRangeAt(0);
          var container = range.startContainer;
          var txt = window.getSelection?window.getSelection():document.selection.createRange().text;
          if(txt){
            let w = window.getSelection();
          // console.log("r",range)
          const start = {
            node: range.startContainer,
            offset: range.startOffset
          };
          const end = {
            node: range.endContainer,
            offset: range.endOffset
          };
          CssTxt(txt,start.offset,end.offset);
          let length = end.offset-start.offset
          var rect = range.getBoundingClientRect();
          console.log(11111111,rect)
          var x = rect.left, y = rect.top;
          let x1 = (rect.left+rect.width)/2
          //y1ä¸æ˜¯ä¸€è¡Œçš„è¯è¦å‡æ‰ä¸€ä¸ªè¡Œé«˜
          let y1 = (rect.top+rect.y)
          if(length!=0){
            showBj(x1,y1,length,txt,range);
          }else{
            hiddenBj();
          }
          }
         
      })
        // $(".contenttext").mouseup(function (e) {
        //         var txt;
        //         var parentOffset = $(this).offset();
        //         var x = e.pageX - parentOffset.left;
        //         var y = e.pageY - parentOffset.top;
        //         txt = window.getSelection();
        //         if (txt.toString().length > 1) {
        //             alert(txt);
        //         }
        //     });
      }
      // function t2(){
      //   $('.chapterInfo').mouseup(function(){
      //     var txt = window.getSelection?window.getSelection():document.selection.createRange().text;
      //     alert(txt) ;
      // })
      // }
      function CssTxt(txt,start,end){

        let allTxt = txt.anchorNode.wholeText;
        //åˆ†å‰²æˆæ•°ç»„ï¼Œåé¢å¯ä»¥æ ¹æ®å¼€å§‹å’Œç»“æŸçš„ä½ç½®å¾—åˆ°æ•°æ®
        allTxt = allTxt.split('');
        var chooseArr = [];
        var chooseTxt = [];
        for(let i=start;i<end;i++){
          chooseArr.push(allTxt[i]);
        }
        chooseTxt = chooseArr.join('')
        console.log("txt",allTxt)
        console.log(chooseArr)
        console.log(chooseTxt)
      }
      function mouseupBj(){

      }
      function hiddenBj(){
        document.getElementById("showBjDiv").style.display = "none"
      }
      function showBj(x,y,length,txt,range){
        let nHtml = "";
        console.log(typeof range)
        var obj = range
        var copy = Object.assign({}, range);
        console.log(copy); // { a: 1 }
        // console.log(JSON.parse(range))
        console.log(JSON.stringify(range))
        // x = x+14*(é€‰å–å­—æ•°)  14ä¸ºfontsize
        //TODO  è¿™é‡Œçš„xåªé€‰å–ä¸€è¡Œçš„å­—æ•°
        // x = x+12*length-5;
        // y = y+20;
        // <div id="showBjDiv" style="display: none;"  class="showBjDiv">
        nHtml+='<div id="showBjDiv" class="showBjDiv" style="position:fixed;left:'+x+"px"+';top:'+y+"px"+'">'
        nHtml+='<span onclick=addBj() class="span-bj">åšç¬”è®°</span>'
        // nHtml+='<span onclick=clickMark("'+(range)+'") class="span-bj">é©¬å…‹ç¬”ğŸ–Š</span>'
        nHtml+= '<span href="javascript:void(0);" class="span-bj" id="mark">é©¬å…‹ç¬”ğŸ–Š</span>';
        nHtml+='</div>'
        // onclick=swiperItemClick('+JSON.stringify(item)+')
        let ele = document.getElementById("showBjDiv")
        // console.log(77,ele)
        $("#showBjDiv").html(nHtml)
        document.getElementById("showBjDiv").style.display = ""
        document.getElementById("mark").addEventListener("click", function(){ 
          clickMark(range)
      });
      }
      function addBj(){
        console.log("æ·»åŠ ç¬”è®°")
      }
     function clickMark(range){
        var selectionContents = range.extractContents();
          var span = document.createElement("span");
          span.style.color = "red";
          span.appendChild(selectionContents);
          range.insertNode(span);
      // SetToBold();
      //TODO é«˜äº®
     }
     function SetToBold () {
          var range = window.getSelection().getRangeAt(0);
          var selectionContents = range.extractContents();
          var span = document.createElement("span");
          // span.style.color = "red";
          span.className='flow-wave'
          span.appendChild(selectionContents);
          range.insertNode(span);
        // var span = document.createElement('span');
        // span.style.color = 'red'
            // document.execCommand('bold', true, null)
            // var result = document.execCommand('bold');
            // console.log(result)
            // document.execCommand('Underline');
        }
      
     
   
     
    
</script>
<style>
  .showBjDiv{
    color: aliceblue;
    background-color: cadetblue;
    width: 160px;
    margin-right: 40px;
    text-align: center;
  }
  .span-bj{
    margin-left: 10px;
    cursor: pointer;
  }
  ::selection {
    background:rgb(214, 105, 132); 
    color:white;
}

.flow-wave {
   background-color: teal;
}
</style>
</html>